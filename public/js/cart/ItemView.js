define(["backbone","backbone.marionette","./template","./Service"],function(t,e,a,i){return e.ItemView.extend({template:a,ui:{input:"input",form:"input"},events:{"click button[data-action=recalculate]":"recalculate","click button[data-action=makeOrder]":"makeOrder","click button[data-action=confirmOrder]":"confirmOrder"},initialize:function(){this.listenTo(this.model,"change",this.render)},_updateCart:function(){this.ui.input.each(function(){i.add(parseInt(this.dataset.id),parseInt(this.value)||0)})},recalculate:function(){this._updateCart(),this.model.fetch({data:i._data})},makeOrder:function(){$(".form-inputs").show()},confirmOrder:function(){var e=$("input[type=email]").val(),a=$("input[type=tel]").val();e&&a&&(this._updateCart(),this.model.save({email:e,phone:a,cart:i._data}).done(function(e){i.removeAll(),t.history.navigate("order/"+e.orderId,{trigger:!0,replace:!0})}))}})});